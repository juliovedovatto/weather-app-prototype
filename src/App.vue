<script setup lang="ts">
/* eslint-disable @typescript-eslint/no-unused-vars */
import { computed, ref } from 'vue';

import { useLocationForecastQuery, type LocationForecastFilters } from './queries/forecast.query';

import CityTabs from '@/components/CityTabs.vue';
import CurrentWeatherCard from '@/components/CurrentWeatherCard.vue';
import ForecastCardsRow from '@/components/ForecastCardsRow.vue';
import HourlyTimeline from '@/components/HourlyTimeline.vue';

const selectedCity = ref('Denver');

function onCityChange(city: string) {
  if (selectedCity.value === city) {
    return;
  }
  selectedCity.value = city;
}

const locationForecastFilters = computed<LocationForecastFilters>(() => ({ q: selectedCity.value, days: 5 }));

const locationForecastQuery = useLocationForecastQuery({
  filters: locationForecastFilters,
});

const isForecastLoading = computed(
  () => locationForecastQuery.isFetching.value || locationForecastQuery.isLoading.value,
);

const currentLocationCondition = computed(() => {
  if (locationForecastQuery.isFetching.value || locationForecastQuery.isError.value) {
    return null;
  }
  return locationForecastQuery.data.value?.current.condition ?? null;
});

const forecastDayConditions = computed(() => {
  if (locationForecastQuery.isFetching.value || locationForecastQuery.isError.value) {
    return [];
  }
  return locationForecastQuery.data.value?.forecast.forecastday.map((d) => d.day.condition) ?? [];
});

const currentLocation = computed(() => {
  if (locationForecastQuery.isFetching.value || locationForecastQuery.isError.value) {
    return null;
  }
  return locationForecastQuery.data.value?.location ?? null;
});
</script>

<template>
  <main class="container flex flex-col gap-12 px-4 py-6 sm:py-14">
    <!-- Welcome headline -->
    <h1 class="text-xl leading-tight font-semibold sm:text-5xl">Good afternoon, Samantha ðŸŒž</h1>

    <!-- City Tabs -->
    <CityTabs @change="onCityChange" />

    <section class="flex flex-col gap-8 md:grid md:grid-cols-[260px_1fr] md:gap-x-7 md:gap-y-0">
      <!-- Current Weather Large Card -->
      <CurrentWeatherCard />

      <div class="flex h-full flex-col gap-8 sm:justify-between sm:gap-0">
        <!-- Hourly timeline -->
        <HourlyTimeline />

        <!-- Forecast Cards Row -->
        <ForecastCardsRow />
      </div>
    </section>
  </main>
</template>
